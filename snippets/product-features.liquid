{% assign product_obj = all_products[product] %}

{%- comment -%}
  Debug: Output raw metafield value
{%- endcomment -%}
Raw features: {{ product_obj.selected_or_first_available_variant.metafields.amzdata.features }}

{%- comment -%}
  Remove extra newlines and whitespace, then parse the JSON string.
{%- endcomment -%}
{% assign raw_features = product_obj.selected_or_first_available_variant.metafields.amzdata.features | strip_newlines | strip %}
{% assign features = raw_features | parse_json %}

{%- comment -%}
  Debug: Check the size of the parsed array.
{%- endcomment -%}
Parsed features size: {{ features.size }}

{% if features and features.size > 0 %}
  <ul>
    {% for feature in features %}
      <li>{{ feature }}</li>
    {% endfor %}
  </ul>
{% else %}
  <p>No features available.</p>
{% endif %}

<p>Test</p>
<p>{{ product_obj.title }}</p>
<p>wrytrwy</p>
